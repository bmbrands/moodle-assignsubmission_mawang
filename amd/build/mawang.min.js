define("assignsubmission_mawang/mawang",["exports","core/templates","core/str","./repository","jquery","core/utils"],(function(_exports,_templates,_str,_repository,_jquery,_utils){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * TODO describe module mawang
   *
   * @module     assignsubmission_mawang/mawang
   * @copyright  2025 Bas Brands <bas@sonsbeekmedia.nl>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_templates=_interopRequireDefault(_templates),_repository=_interopRequireDefault(_repository),_jquery=_interopRequireDefault(_jquery);class Mawang{constructor(){this.rootElement=document.querySelector(".mawang-form"),this.init()}async init(){this.rootElement.querySelectorAll("textarea").forEach((async textarea=>{const areaid=textarea.dataset.fieldid+"-wordcounter",statusid=textarea.dataset.fieldid+"-status",count=textarea.value.split(/\s+/).filter((word=>word.length>0)).length,{html:html,js:js}=await _templates.default.renderForPromise("assignsubmission_mawang/fieldactions",{areaid:areaid,statusid:statusid,count:count});_templates.default.appendNodeContents(textarea.parentNode,html,js)})),this.bindEvents()}async bindEvents(){const textareas=this.rootElement.querySelectorAll("textarea"),saveDraftDebounce=(0,_utils.debounce)(this.saveDraft,2e3);textareas.forEach((async textarea=>{textarea.addEventListener("input",(async event=>{const wordCounter=document.getElementById(event.target.dataset.fieldid+"-wordcounter"),count=event.target.value.split(/\s+/).filter((word=>word.length>0)).length;wordCounter.innerHTML=await(0,_str.getString)("words","assignsubmission_mawang",count),saveDraftDebounce(event.target)}))})),document.addEventListener("click",(async event=>{const popOvers=document.querySelectorAll('[data-toggle="popover"]'),currentPopover=event.target.closest('[data-toggle="popover"]');popOvers.length>0&&popOvers.forEach((popover=>{popover!==currentPopover&&(0,_jquery.default)(popover).popover("hide")}))}))}async saveDraft(field){const statusdiv=document.getElementById(field.dataset.fieldid+"-status");statusdiv.classList.add("saving");const data={assignmentid:parseInt(field.dataset.assignmentid),fieldid:parseInt(field.dataset.fieldid),value:field.value};await _repository.default.storeDraft(data)&&statusdiv.classList.remove("saving")}}var _default={init:()=>{new Mawang}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=mawang.min.js.map